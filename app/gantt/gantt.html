<link rel="stylesheet" href="gantt/gantt.css">
<div id="gantt" class="exposition_block">

    <div class="gantt_block">
        <div class="top-bar">
            <!--STATUS BAR-->
            <div ng-controller="StatusBarController as statusCtrl" class="btn-sm status-bar">
                <span ng-show="statusCtrl.notification.message">Status:</span>
                <span ng-style="{color: statusCtrl.notification.isError ? 'red' : 'grey'}">
                    {{statusCtrl.notification.message}}
                </span>
            </div>

            <!--TABS-->
            <div class="btn-group tabs" role="group">
                <button dialog-trigger="add-task" type="button" class="btn btn-default btn-sm">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                    Add Task
                </button>
                <button dialog-trigger="settings" type="button" class="btn btn-default btn-sm">
                    <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
                    Settings
                </button>
            </div>

            <div style="clear:both"></div>
        </div>

        <!--GANTT-->
        <div ng-controller="GanttController as ganttCtrl" dialog-background>

            <div ng-if="!ganttCtrl.isEmpty" class="gantt">

                <!--TIMELINE-->
                <timeline date-interval="ganttCtrl.boundaries" config="ganttCtrl.timelineConfig"></timeline>

                <!--TASKS-->
                <div class="tasks_block">
                    <timeline-stripes date-interval="ganttCtrl.boundaries"
                                      config="ganttCtrl.timelineConfig"></timeline-stripes>

                    <div ng-controller="TaskListController as listCtrl" class="tasks_wrapper">

                        <div ng-repeat="task in ganttCtrl.tasks"
                             ng-controller="TaskController as taskCtrl"
                             class="task_wrapper">

                            <div class="task_line_wrapper"
                                 style="margin-left: {{taskCtrl.position.left}}%; width: {{taskCtrl.position.width}}%">

                                <div class="top_block" style="direction: {{taskCtrl.closerToEnd ? 'rtl' : 'ltr'}}">
                                    <span class="task_name">{{taskCtrl.name}}</span>
                                <span class="date_label"> -
                                    {{taskCtrl.start.format('D MMM YYYY')}} /
                                    {{taskCtrl.end.format('D MMM YYYY')}}
                                </span>
                                </div>

                                <div class="bottom_block">
                                    <div ng-show="taskCtrl.isMilestone"
                                         class="rhombus {{taskCtrl.isCompleted? 'done_green' : 'left_red'}}"></div>
                                    <div ng-hide="taskCtrl.isMilestone" class="task_line left_red">
                                        <div style="direction: {{taskCtrl.closerToEnd ? 'rtl' : 'ltr'}}"
                                             class="task_completed_part_label">
                                            <b>{{taskCtrl.percentComplete}}</b>%
                                        </div>
                                        <div class="task_completed_part done_green"
                                             style="width:{{taskCtrl.percentComplete}}%"></div>
                                    </div>
                                    <div ng-show="taskCtrl.isParent" class="parent_indicator"></div>
                                </div>

                            </div>
                            <div style="clear: both"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!--TIME LINE SETTINGS-->
            <div ng-controller="TimelineOptionsController as timelineCtrl"
                 dialog-window="settings"
                 class="dialog-window-right">

                <timeline-options config="ganttCtrl.timelineConfig"
                                  on-save="timelineCtrl.save"
                                  on-back="timelineCtrl.back"></timeline-options>
            </div>

            <!--TASK MANAGEMENT-->
            <div ng-controller="TaskEditorController as taskEditorCtrl"
                 dialog-window="add-task"
                 class="col-md-offset-3 col-md-6">

                <form ng-submit="taskEditorCtrl.saveTask()">
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input ng-model="taskEditorCtrl.task.name"
                               class="form-control"
                               required
                               type="text"
                               id="name"
                               placeholder="Name">
                    </div>

                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="start">Start date</label>
                                <input ng-model="taskEditorCtrl.task.date.start"
                                       class="form-control"
                                       type="date"
                                       required
                                       id="start">
                            </div>
                            <div class="col-md-6">
                                <label for="end">End date</label>
                                <input ng-model="taskEditorCtrl.task.date.end"
                                       class="form-control"
                                       type="date"
                                       required
                                       id="end">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="percentage-complete">Percentage complete</label>
                        <input ng-model="taskEditorCtrl.task.percentComplete"
                               required
                               type="number"
                               max="100"
                               min="0"
                               class="form-control"
                               id="percentage-complete">
                    </div>

                    <div class="text-right">
                        <button type="submit" class="btn btn-default">Save</button>
                        <button type="button" dialog-trigger="add-task" class="btn btn-default">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

    </div>
</div>

<style>
    .todo {
        font-weight: bold;
        font-size: 15px;
        margin-top: 20px;
    }

    .todo.todo-done li {
        color: green;
    }

    .todo.todo-canceled li {
        color: grey;
        text-decoration: line-through;
    }
</style>

<div style="margin:20px">
    <h2>TODOs:</h2>
    <ul class="todo todo-current">
        <li> task context menu [mouse right click]</li>
        <li> $scope.task.isParent = $scope.task.parent_id == 0; - is not correct!</li>
        <li> 2 views for app and app-dev</li>
        <li> millestone (ng-if/ng-show) make more elegant</li>
        <li> wrapper for httpMock, hot for common.http.service</li>
    </ul>
    <ul class="todo todo-done">
        <li> ng-if="dateInterval" not working in timeline directive</li>
        <li> extract timeline into directive!</li>
        <li> list.overallDateInterval resolve!</li>
        <li> multiple stripe types</li>
    </ul>
    <ul class="todo todo-canceled">
        <li> use $router resolve to load dependencies for gantt data(and settings)?</li>
        <li> user service in common http service?</li>
    </ul>
</div>

